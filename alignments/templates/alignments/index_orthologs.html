{% load static %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

 <script>


</script>
<script src="{% static "alignments/vue.js" %}">
</script>

<div class="container">
	<h4>Select phylogenetic groups for TwinCons<br/></h4>
	<div id="app">
		Select two taxgroups:<br/>
	<tree-menu 
			   :nodes="tree.nodes" 
			   :depth="0"   
			   :label="tree.label"
			   >Loading phylogenetic tree...</tree-menu>
	</div>
  </div>
  
  <script type="text/x-template" id="tree-menu">
	<div class="tree-menu">
	  <div class="label-wrapper" @click="toggleChildren">
		<div :style="indent" :class="labelClasses">
			<i v-for="node in nodes" class="fa" :class="iconClasses"></i>
			<!-- [[label]], [[taxID]] -->
			[[label]]
			<input type="checkbox" id="check" name="check" unchecked>
			
		</div>
	  </div>
	  <tree-menu 
		v-if="showChildren"
		v-for="node in nodes"
		v-bind:key="node.id"
		:nodes="node.nodes" 
		:label="node.label"
		:depth="depth + 1"
		:taxID="node.taxID"
	  >
	  </tree-menu>
	</div>
  </script>

<script src={% static 'alignments/tree_menu.js' %}></script>

<script>
	var pdb = null;
function myFunction(alignment_name,aln_type) {
	var
		getAlignment = document.getElementById("getAlignment"),
		parent_taxid1 = getAlignment.getAttribute("value1"),
		parent_taxid2 = getAlignment.getAttribute("value2");
	
	// var res = aln_type.concat(alignment_name).concat("/").concat(parent_taxid2);
	// localhost:8000/alignments/twc-api/uL16/2/2157/511145
	var res = "twincons/" + alignment_name + "/" + parent_taxid1 + "/" + parent_taxid2 + "/" + pdb;
	// alert(res);
	console.log(res);
	window.location.href = res;
}

function myFunction2(struc_id) {
	var struc_data;
	$.ajax({
	url: '/struc-api/'+struc_id,
	type: "GET",
	dataType: "json",
	success: function (data) {
 		console.log(data);
 		struc_data = data;},
	error: function (error) {
		console.log(`Error ${error}`);},
	 async: false
	});

	pdb = struc_data["PDBID"];
	
	if (struc_id.length == 0) document.getElementById("chain_selector").innerHTML = "<option></option>";
	else {
		var catOptions = "";
		for (polymer_chain of struc_data["Polymers and Chains"]) {
			catOptions += "<option value="+polymer_chain[3]+">" + polymer_chain[0] + "</option>";
		}
		document.getElementById("chain_selector").innerHTML = catOptions;
	}
}

function myFunction3(chain) {
	window.location.href = "twincons/" + pdb + "/" + chain
}
</script>

<form enctype = "multipart/form-data" action = "" method = "post">{% csrf_token %}
   <p>CSV Selection: <input type = "file" accept=".csv" name = "filename" /></p>
   <p><input type = "submit" value = "Upload CSV" /></p>
</form>

<form enctype = "multipart/form-data" action = "" method = "post">{% csrf_token %}
   <p>Alignment Selection: <input type = "file" accept=".fa, .fas" name = "filename" /></p>
   <p><input type = "submit" value = "Upload Alignment" /></p>
</form>

<form enctype = "multipart/form-data" action = "" method = "post">{% csrf_token %}
   <p>
	  Input Alignment Text: <br>
	  <textarea name = 'alignmentText' cols="50" rows="20"></textarea>
   </p>
   <p>
	  <input type = "submit" value = "Upload Alignment Text">
   </p>
</form>

<p>AND</p> 

<select id = "getPDB" onchange="myFunction2(this.value)">
	<option>Select a PDB</option>
	{% for pdb in threeDstructures %}
		<option value={{ pdb.number_3d_structure_id }}>{{ pdb.structurename }}</option>
	{% endfor %}
</select>

<p>AND</p> 

<select name="chain_selector" id="chain_selector">
	<option value="" disabled selected>Select polymer</option>
</select>

<button onclick="myFunction3(chain_selector.value)" method = "post">Use User-Uploaded Fasta

</button> {{file_name}}

<p>OR</p>

<select id="getAlignment" onchange= "myFunction(this.value, 'rProtein/');">
	<option >Select an alignment</option>
	{% for aln in some_Alignments %}
		{%if 'LSU' not in aln.name%}
			<option value={{ aln.name }}>{{ aln.name }}</option>
		{% endif %}
	{% endfor %}
</select>

<p>OR</p>

<select id="getAlignment" onchange= "myFunction(this.value, 'rRNA/');">
	<option value="">Select an rRNA alignment</option>
	{% for aln in some_Alignments %}
		{%if 'LSU' in aln.name%}
			<option value={{ aln.name }}>{{ aln.name }}</option>
		{% endif %}
	{% endfor %}
</select>

